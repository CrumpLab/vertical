---
title: "Using vertical"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## See an example

You can check out the project template that gets loaded by vertical here [https://github.com/CrumpLab/vertical_template](https://github.com/CrumpLab/vertical_template), and the resulting website that is generated by the template here [https://github.com/CrumpLab/vertical_template](https://crumplab.github.io/vertical_template/). 

If you want to use vertical (see the instructions below), you will basically be editing/modifying the pieces of the template to suite your research project, and then generating the website to share your research assets.

## Install vertical

Step 1 is to install the `vertical` package. If you don't already have `devtools` installed, do that first. Then you can run the following in R-studio:

```
devtools::install_github("CrumpLab/vertical")
```

## Create a new vertical project

Once you have installed `vertical` you will want to reload R-studio. `vertical` installs a new project template for R-studio. To make a new project, click on the little R cube on the top right-hand corner and choose new project. Then, when you choose a new Directory for your project, you should see a list of templates. Scroll down and find "Vertical research project", use that one.

```{r, echo=FALSE}
twee <- function(path = getwd(), level = Inf) {
  
  fad <-
    list.files(path = path, recursive = TRUE,no.. = TRUE, include.dirs = TRUE)

  fad_split_up <- strsplit(fad, "/")

  too_deep <- lapply(fad_split_up, length) > level
  fad_split_up[too_deep] <- NULL
  
  jfun <- function(x) {
    n <- length(x)
    if(n > 1)
      x[n - 1] <- "|__"
    if(n > 2)
      x[1:(n - 2)] <- "   "
    x <- if(n == 1) c("-- ", x) else c("   ", x)
    x
  }
  fad_subbed_out <- lapply(fad_split_up, jfun)
  
  cat(unlist(lapply(fad_subbed_out, paste, collapse = "")), sep = "\n")
}
```

## Motivation behind vertical

`vertical` makes use of existing templates in R for doing useful things related to sharing research assets. To give a brief history to vertical, it grew out of me trying to use an R package to share a research project, rather than an R package. Why would anyone want to do that? Here's why. 

1. R packages have a well thought out existing file-structure that is useful for organizational purposes.
2. Sometimes research project involve writing custom functions, and putting them in an R package makes sharing the functions easy.
3. R packages can include data, so they provide a way to share data from a research package, and a natural way to document the data using the same schemes for document R functions
4. R packages include a vignette folder that is used to write documents that show how an R package can be used. In other words, R package structure already have a way of sharing documents as part of the R package, so I was originally thinking to package the research paper in the vignette folder.
5. **Most important**, there are amazing tools like `pkgdown` that render R packages into nice websites, basically automatically without doing much work

So, there are several existing R tools that make it easy to share the contents of an R package as a website, and many of the things in an R package include the kind of assets that are naturally produced as part of a research project. 

However, there are additional things a research project can produce (my background is cognitive psychology, so I've written vertical with behavioral experiments in mind). For example, you might want to write slides to give a talk about your research, you might want to write scripts to run an experiment, you might write your work up into a manuscript and submit it. I do all of these things in R, using R markdown in various ways. So, enter vertical, which allows these additional assets to be compiled into the website along with everything else.

So, the basic idea behind vertical is to work on your research, create your assets, and then get a website to share everything for free, without doing much work at the end. This way you can focus on the content of your work, and not the style of your sharing...but you can style that too if you want.

## Using vertical

Right now vertical is mainly a project template, so using it involves using the directory structure that is set up in your new project. The basic file structure of a vertical template is described below:

### Vertical file structure

```
-- _pkgdown.yml - controls for displaying the website
-- DESCRIPTION - describe your R package if you build one
-- docs
   |__Where all the website stuff goes
-- experiments
   |__Experiment scripts and demos
-- man
   |__Any function documentation
-- manuscript
   |__Your manuscript files (e.g., writing paper in papaja)
   |__draft_manuscript.pdf
   |__draft_manuscript.Rmd
   |__draft_manuscript.tex
   |__r-references.bib
-- NAMESPACE - for R packages
-- Package Helper.R - helpful scripts for controlling vertical input/output
-- R
   |__Any R functions you want to share
-- README.md - front page of the website
-- slides
   |__Slide decks written in R
-- vertical.Rproj - the R project
-- vignettes
   |__Supplementary materials that get rendered as vignettes
```

## R packages and pkgdown

The heavy lifting to build your vertical website is all done by `pkgdown`. `pkgdown` <https://pkgdown.r-lib.org> is an R package that builds a website for R package documentation.

When you load a vertical project, the template includes a skeleton for making R packages. If you do not want to share custom functions you do not need to make use of this feature. To avoid this feature **do not press Install and Restart under the build tab in R-studio**.

In order to compile the vertical template into a website, you need to first install `pkgdown`. After that you just need to run one command `build_site()`, and boom, you've got a website.

Check out the `Vertical Helper.R` file for example code to build the site. The relevant line is:

```{r, eval=FALSE}
pkgdown::build_site()
```

If you are going to wade into making an R package using vertical, then I highly recommend reading [http://r-pkgs.had.co.nz](http://r-pkgs.had.co.nz). And, pay attention to the `roxygen2` option for writing function documentation.

The `pkgdown`function automatically builds .rmd files in the vignettes folder, and any R function documentation, along with all of the html for the website, and puts all of that stuff into the docs folder. This is useful, because if you upload your whole vertical project to github (as a way to share everything), you can turn on the github pages option, and the website you generate will be served from that repo.

Additionally, there are several common actions that are performed when making R packages (e.g., steps required to make a new function). The `usethis` package is very helpful for automating some of these steps. Examples are included in the `Vertical Helper.R` file.

## APA manuscript

The `manuscript` folder contains an example APA paper written using the `papaja` package. This is written in R markdown and compiled to .pdf. The .pdf is then shared on the website. More information about writing APA papers with `papaja` can be found on the `papaja` documentation site <https://crsh.github.io/papaja_man/introduction.html>

Note: that the .pdf generated must be copied by hand into the manuscript folder in the docs folder...this step will be automated in a future version of vertical.

## slides

The `slides` folder contains an example slide deck using `slidy`. The slide deck is written in R markdown (.Rmd file), and also uses custom .css to change the style of the presentation from the default. To place the generated html for the slide presentation into the docs folder you can run, from the `Vertical Helper.R` script.

```{r, eval=FALSE}
# render slides to docs (for display on website)
vertical::render_folder_to_docs("slides")
```

The `slides` folder can also be considered as a placeholder for any slide deck. Use this folder to write your slide deck using your preferred method. If you use an R markdown approach, and that approach produces an html slide deck, then the generated html needs to be placed in the docs folder to be rendered on the website. Also, the yml needs to be edited to point to the location of slide files in the docs folder. If your method for producing slides involves powerpoint, or say a pdf file, those can be shared on the website as well by placing those files in the docs folder and editing the yml to link to them. As vertical improves, one plan is to provide functions that automate the process of file copying and yml editing.


## experiments

The experiments folder is a place where you can save and share your experiment scripts. If you have built an experiment that can run in a web-browser, then you can even share a demo of the experiment. 

Currently, this folder contains a zip file of the most recent release of jspsych, a javascript library for running web-based behavioral experiments .

For more information on using jsPysch, check out the jsPsych documentation <https://www.jspsych.org>.


## Hosting the site

1. running `build_site()` will compile almost everything needed for the webpage into the `docs` folder.
2. If all of the files are placed in a public Github repository (free), then the Github repository can serve the website using the Github pages feature (turn this on under settings for the repository, and choose serve from docs folder)
3. In general, any file that is in the docs folder will be served to web.
4. The files in the `slides`, `manuscript`, and `experiments` folders are not automatically compiled into .html by pkgdown. So, for now, to share content from those folders I manually copy each folder into the docs folder.
5. The structure and appearance of the website can be modified (e.g., the navbar) by editing the `_pkgdown.yml` file. For more information on editing the yml file, see the pkgdown documentation.





